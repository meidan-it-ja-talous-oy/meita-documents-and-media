steps:
# meita-bucket-browser-block

- name: node:18.20.4
  entrypoint: yarn

- name: node:18.20.4
  entrypoint: yarn
  args: ['add', 'replace-in-files-cli', '-D']

- name: node:18.20.4
  entrypoint: yarn
  args: ['run', 'replace-in-files', '--regex="Version:.*"', '--replacement="Version:         $TAG_NAME"', 'block.php']

- name: node:18.20.4
  entrypoint: yarn
  args: ['run','cloudbuild']

- name: gcr.io/cloud-builders/gcloud
  entrypoint: 'mv'
  args: [ 'dist', 'bucket-browser-block' ]

# Taged
- name: europe-north1-docker.pkg.dev/rauni-0/tools/zip
  args: ['-r9T', 'bucket-browser-block-$TAG_NAME.zip', './bucket-browser-block']

# Overwrite latest
- name: europe-north1-docker.pkg.dev/rauni-0/tools/zip
  args: ['-r9T', 'bucket-browser-block-latest.zip', './bucket-browser-block']

artifacts:
  objects:
    location: 'gs://wp-repository/plugins'
    paths: ['bucket-browser-block-$TAG_NAME.zip', 'bucket-browser-block-latest.zip']